<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>时间选择器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.1.0/fonts/remixicon.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#007AFF',
                        'primary-light': '#5AC8FA',
                        'primary-dark': '#0051D0'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 min-h-screen py-4 px-4">
    <div class="max-w-md mx-auto bg-white rounded-2xl shadow-lg overflow-hidden">
        <!-- Header -->
        <div class="bg-gradient-to-r from-primary to-primary-light px-6 py-4">
            <h2 class="text-white text-lg font-medium">选择时间</h2>
        </div>

        <!-- Time Display -->
        <div class="px-6 py-4 bg-gray-50 border-b">
            <div class="flex items-center justify-center space-x-2">
                <div class="bg-white rounded-lg px-4 py-2 border">
                    <input type="text" id="hourInput" class="text-2xl font-mono text-center w-12 border-none outline-none bg-transparent" 
                           value="07" maxlength="2" readonly>
                </div>
                <span class="text-2xl font-mono text-gray-600">:</span>
                <div class="bg-white rounded-lg px-4 py-2 border">
                    <input type="text" id="minuteInput" class="text-2xl font-mono text-center w-12 border-none outline-none bg-transparent" 
                           value="29" maxlength="2" readonly>
                </div>
                <span class="text-2xl font-mono text-gray-600">:</span>
                <div class="bg-white rounded-lg px-4 py-2 border">
                    <input type="text" id="secondInput" class="text-2xl font-mono text-center w-12 border-none outline-none bg-transparent" 
                           value="41" maxlength="2" readonly>
                </div>
                <div class="ml-4">
                    <select id="ampmSelect" class="bg-white border rounded-lg px-3 py-2 text-lg font-medium focus:outline-none focus:ring-2 focus:ring-primary">
                        <option value="AM">上午</option>
                        <option value="PM">下午</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Mode Selector -->
        <div class="px-6 py-4 border-b">
            <div class="flex space-x-2">
                <button id="hourMode" class="flex-1 py-2 px-4 rounded-lg bg-primary text-white font-medium transition-colors">
                    时
                </button>
                <button id="minuteMode" class="flex-1 py-2 px-4 rounded-lg bg-gray-200 text-gray-700 font-medium transition-colors">
                    分
                </button>
                <button id="secondMode" class="flex-1 py-2 px-4 rounded-lg bg-gray-200 text-gray-700 font-medium transition-colors">
                    秒
                </button>
            </div>
        </div>

        <!-- Analog Clock -->
        <div class="px-6 py-6">
            <div class="relative mx-auto" style="width: 280px; height: 280px;">
                <!-- Clock Face -->
                <div id="clockFace" class="absolute inset-0 rounded-full border-4 border-gray-200 bg-white shadow-inner">
                    <!-- Numbers will be generated by JavaScript -->
                </div>
                
                <!-- Center Dot -->
                <div class="absolute top-1/2 left-1/2 w-4 h-4 bg-primary rounded-full transform -translate-x-1/2 -translate-y-1/2 z-20"></div>
                
                <!-- Hour Hand -->
                <div id="hourHand" class="absolute top-1/2 left-1/2 w-1 bg-gray-800 rounded-full transform-gpu origin-bottom z-10" 
                     style="height: 80px; margin-left: -2px; margin-top: -80px; transform: rotate(0deg)"></div>
                
                <!-- Minute Hand -->
                <div id="minuteHand" class="absolute top-1/2 left-1/2 w-1 bg-primary rounded-full transform-gpu origin-bottom z-10" 
                     style="height: 100px; margin-left: -2px; margin-top: -100px; transform: rotate(0deg)"></div>
                
                <!-- Second Hand -->
                <div id="secondHand" class="absolute top-1/2 left-1/2 w-0.5 bg-red-500 rounded-full transform-gpu origin-bottom z-10" 
                     style="height: 110px; margin-left: -1px; margin-top: -110px; transform: rotate(0deg)"></div>
            </div>
        </div>

        <!-- Utility Components -->
        <div class="px-6 py-4 border-t">
            <button id="setNowBtn" class="w-full py-2 px-4 bg-gray-100 text-gray-700 rounded-lg font-medium hover:bg-gray-200 transition-colors flex items-center justify-center space-x-2">
                <i class="ri-time-line"></i>
                <span>现在</span>
            </button>
        </div>

        <!-- Confirmation Button -->
        <div class="px-6 py-4 border-t bg-gray-50">
            <button id="confirmBtn" class="w-full py-3 px-4 bg-primary text-white rounded-lg font-medium hover:bg-primary-dark transition-colors flex items-center justify-center space-x-2">
                <i class="ri-check-line"></i>
                <span>确认</span>
            </button>
        </div>
    </div>

    <script>
        class AnalogTimePicker {
            constructor() {
                this.mode = 'hour'; // 'hour', 'minute', 'second'
                this.hour = 7;
                this.minute = 29;
                this.second = 41;
                this.ampm = 'AM';
                this.isDragging = false;
                this.clockCenter = { x: 140, y: 140 };
                this.clockRadius = 120;
                
                this.initializeElements();
                this.bindEvents();
                this.updateDisplay();
                this.renderClockNumbers();
                this.updateHands();
            }

            initializeElements() {
                this.clockFace = document.getElementById('clockFace');
                this.hourInput = document.getElementById('hourInput');
                this.minuteInput = document.getElementById('minuteInput');
                this.secondInput = document.getElementById('secondInput');
                this.ampmSelect = document.getElementById('ampmSelect');
                this.hourMode = document.getElementById('hourMode');
                this.minuteMode = document.getElementById('minuteMode');
                this.secondMode = document.getElementById('secondMode');
                this.hourHand = document.getElementById('hourHand');
                this.minuteHand = document.getElementById('minuteHand');
                this.secondHand = document.getElementById('secondHand');
                this.setNowBtn = document.getElementById('setNowBtn');
                this.confirmBtn = document.getElementById('confirmBtn');
            }

            bindEvents() {
                // Mode switching
                this.hourMode.addEventListener('click', () => this.setMode('hour'));
                this.minuteMode.addEventListener('click', () => this.setMode('minute'));
                this.secondMode.addEventListener('click', () => this.setMode('second'));

                // Clock face interactions
                this.clockFace.addEventListener('mousedown', (e) => this.startDrag(e));
                this.clockFace.addEventListener('touchstart', (e) => this.startDrag(e), { passive: false });
                document.addEventListener('mousemove', (e) => this.drag(e));
                document.addEventListener('touchmove', (e) => this.drag(e), { passive: false });
                document.addEventListener('mouseup', () => this.stopDrag());
                document.addEventListener('touchend', () => this.stopDrag());

                // AM/PM selector
                this.ampmSelect.addEventListener('change', (e) => {
                    this.ampm = e.target.value;
                    this.updateDisplay();
                });

                // Utility buttons
                this.setNowBtn.addEventListener('click', () => this.setCurrentTime());
                this.confirmBtn.addEventListener('click', () => this.confirmSelection());

                // Prevent text selection during drag
                this.clockFace.addEventListener('selectstart', (e) => e.preventDefault());
            }

            setMode(mode) {
                this.mode = mode;
                
                // Update button styles
                [this.hourMode, this.minuteMode, this.secondMode].forEach(btn => {
                    btn.classList.remove('bg-primary', 'text-white');
                    btn.classList.add('bg-gray-200', 'text-gray-700');
                });

                const activeBtn = mode === 'hour' ? this.hourMode : 
                                 mode === 'minute' ? this.minuteMode : this.secondMode;
                activeBtn.classList.remove('bg-gray-200', 'text-gray-700');
                activeBtn.classList.add('bg-primary', 'text-white');

                this.renderClockNumbers();
            }

            renderClockNumbers() {
                // Clear existing numbers
                this.clockFace.querySelectorAll('.clock-number').forEach(el => el.remove());

                let numbers, step;
                if (this.mode === 'hour') {
                    numbers = Array.from({length: 12}, (_, i) => i === 0 ? 12 : i);
                    step = 30; // 360° / 12
                } else {
                    numbers = Array.from({length: 12}, (_, i) => i * 5);
                    step = 30; // 360° / 12 (showing every 5 units)
                }

                numbers.forEach((num, index) => {
                    const angle = (index * step - 90) * Math.PI / 180; // -90 to start from top
                    const x = this.clockCenter.x + (this.clockRadius - 25) * Math.cos(angle);
                    const y = this.clockCenter.y + (this.clockRadius - 25) * Math.sin(angle);

                    const numberEl = document.createElement('div');
                    numberEl.className = 'clock-number absolute w-8 h-8 flex items-center justify-center text-sm font-medium text-gray-700 rounded-full cursor-pointer hover:bg-gray-100 transition-colors';
                    numberEl.style.left = `${x - 16}px`;
                    numberEl.style.top = `${y - 16}px`;
                    numberEl.textContent = num.toString().padStart(2, '0');

                    // Highlight current selection
                    const currentValue = this.mode === 'hour' ? this.hour : 
                                       this.mode === 'minute' ? this.minute : this.second;
                    
                    if ((this.mode === 'hour' && num === this.hour) ||
                        (this.mode !== 'hour' && num === currentValue)) {
                        numberEl.classList.add('bg-primary', 'text-white');
                        numberEl.classList.remove('text-gray-700', 'hover:bg-gray-100');
                    }

                    numberEl.addEventListener('click', () => this.selectNumber(num));
                    this.clockFace.appendChild(numberEl);
                });
            }

            selectNumber(num) {
                if (this.mode === 'hour') {
                    this.hour = num;
                } else if (this.mode === 'minute') {
                    this.minute = num;
                } else {
                    this.second = num;
                }
                
                this.updateDisplay();
                this.updateHands();
                this.renderClockNumbers();
            }

            startDrag(e) {
                e.preventDefault();
                this.isDragging = true;
                this.updateFromMousePosition(e);
            }

            drag(e) {
                if (!this.isDragging) return;
                e.preventDefault();
                this.updateFromMousePosition(e);
            }

            stopDrag() {
                this.isDragging = false;
            }

            updateFromMousePosition(e) {
                const rect = this.clockFace.getBoundingClientRect();
                const clientX = e.clientX || (e.touches && e.touches[0].clientX);
                const clientY = e.clientY || (e.touches && e.touches[0].clientY);
                
                const x = clientX - rect.left - this.clockCenter.x;
                const y = clientY - rect.top - this.clockCenter.y;
                
                let angle = Math.atan2(y, x) * 180 / Math.PI + 90;
                if (angle < 0) angle += 360;

                if (this.mode === 'hour') {
                    const hourValue = Math.round(angle / 30);
                    this.hour = hourValue === 0 ? 12 : hourValue;
                } else if (this.mode === 'minute') {
                    this.minute = Math.round(angle / 6);
                    if (this.minute === 60) this.minute = 0;
                } else {
                    this.second = Math.round(angle / 6);
                    if (this.second === 60) this.second = 0;
                }

                this.updateDisplay();
                this.updateHands();
                this.renderClockNumbers();
            }

            updateHands() {
                // Hour hand (considering minutes for smooth movement)
                const hourAngle = ((this.hour % 12) * 30 + this.minute * 0.5) - 90;
                this.hourHand.style.transform = `rotate(${hourAngle}deg)`;

                // Minute hand
                const minuteAngle = (this.minute * 6) - 90;
                this.minuteHand.style.transform = `rotate(${minuteAngle}deg)`;

                // Second hand
                const secondAngle = (this.second * 6) - 90;
                this.secondHand.style.transform = `rotate(${secondAngle}deg)`;
            }

            updateDisplay() {
                this.hourInput.value = this.hour.toString().padStart(2, '0');
                this.minuteInput.value = this.minute.toString().padStart(2, '0');
                this.secondInput.value = this.second.toString().padStart(2, '0');
                this.ampmSelect.value = this.ampm;
            }

            setCurrentTime() {
                const now = new Date();
                let hour = now.getHours();
                
                this.ampm = hour >= 12 ? 'PM' : 'AM';
                this.hour = hour === 0 ? 12 : hour > 12 ? hour - 12 : hour;
                this.minute = now.getMinutes();
                this.second = now.getSeconds();
                
                this.updateDisplay();
                this.updateHands();
                this.renderClockNumbers();
            }

            confirmSelection() {
                const selectedTime = this.getSelectedValues();
                alert(`已确认时间: ${selectedTime.values[0].time}`);
            }

            getSelectedValues() {
                // Convert to 24-hour format for consistent output
                let hour24 = this.hour;
                if (this.ampm === 'PM' && this.hour !== 12) {
                    hour24 = this.hour + 12;
                } else if (this.ampm === 'AM' && this.hour === 12) {
                    hour24 = 0;
                }

                const timeString = `${hour24.toString().padStart(2, '0')}:${this.minute.toString().padStart(2, '0')}:${this.second.toString().padStart(2, '0')}`;

                return {
                    type: "single",
                    values: [
                        {
                            time: timeString
                        }
                    ]
                };
            }
        }

        // Global function for external access
        let timePickerInstance;

        function getSelectedValues() {
            return timePickerInstance ? timePickerInstance.getSelectedValues() : null;
        }

        // Initialize the component
        document.addEventListener('DOMContentLoaded', () => {
            timePickerInstance = new AnalogTimePicker();
        });
    </script>
</body>
</html>